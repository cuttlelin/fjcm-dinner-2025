<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校友留言 - 輔大管院</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header>
        <h1>輔大管院 2024 校友晚宴</h1>
        <p>歡迎回家！請留下您對輔大的回憶</p>
    </header>

    <div class="container">
        <div class="card">
            <h2 style="color:#003366; margin-top:0;"><i class="fas fa-edit"></i> 填寫留言</h2>
            <form id="alum-form">
                <label>1. 對輔大印象最深刻的是什麼？(關鍵字)</label>
                <input type="text" id="impression" placeholder="例如：中美堂、大菠蘿..." required>
                
                <label>2. 最想跟輔大及管理學院說的話</label>
                <textarea id="message" rows="4" placeholder="寫下您的祝福..." required></textarea>

                <button type="submit" class="submit-btn" id="btn-submit">送出留言</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        // ⚠️【請將這裡換成您剛剛複製的設定內容】⚠️
        const firebaseConfig = {
            apiKey: "AIzaSyDWWXuU16UwB8iXo5tEVuzYYVP9ppslisk",
			authDomain: "fjcu-dinner.firebaseapp.com",
			projectId: "fjcu-dinner",
			storageBucket: "fjcu-dinner.firebasestorage.app",
			messagingSenderId: "461813917984",
			appId: "1:461813917984:web:717f2404d20dd9a0d68f45",
			measurementId: "G-9TQS9R3CDC"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        document.getElementById('alum-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            btn.disabled = true;
            btn.innerText = "傳送中...";

            const imp = document.getElementById('impression').value.trim();
            const msg = document.getElementById('message').value.trim();

            if(imp && msg) {
                const newPostRef = push(ref(db, 'messages'));
                set(newPostRef, {
                    keyword: imp,
                    content: msg,
                    timestamp: Date.now()
                }).then(() => {
                    alert("收到您的留言了！請看前方大螢幕！");
                    document.getElementById('alum-form').reset();
                    btn.disabled = false;
                    btn.innerText = "送出留言";
                }).catch((error) => {
                    alert("發生錯誤，請重試");
                    console.error(error);
                    btn.disabled = false;
                });
            }
        });
    </script>
</body>
</html>